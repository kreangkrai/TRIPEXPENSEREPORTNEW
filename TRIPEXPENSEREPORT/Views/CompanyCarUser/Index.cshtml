@model List<TRIPEXPENSEREPORT.Models.CompanyModel>
@{
    ViewData["Title"] = "TE : รถบริษัท";
}

<style>
    .hidden {
        display: none;
    }

    input[type="checkbox"] {
        transition: all 0.3s ease; /* ทำให้เปลี่ยนสี/ขนาดนุ่มนวล */
    }

        input[type="checkbox"]:checked {
            transform: scale(1.15); /* ขยายนิดนึงตอนกด */
            background-color: #1e90ff
        }

    /* สไตล์สำหรับ input */
    input[type="text"] {
        transition: opacity 0.3s ease, background-color 0.3s ease; /* แอนิเมชันนุ่มนวล */
    }
        /* input ตอน disable */
        input[type="text"]:disabled {
            cursor: not-allowed;
            /* opacity: 0.4; */ /* จางลง */
            /* background-color: #e9ecef; */ /* สีเทาอ่อน */
        }
        /* input ตอน enable */
        input[type="text"]:not(:disabled) {
            opacity: 1; /* ชัดเจน */
            /* background-color: #ffffff; */ /* สีขาวตอนกรอกได้ */
        }
</style>


<div class="container-fluid">
    <div class="row">
        <!-- Sidebar (ซ้าย) : Filter -->
        <div class="col-md-2 bg-light p-3 kanit-medium">
            <div class="card border-0 shadow-sm h-0 p-2 rounded-10">
                <h5 class="mb-3" style="letter-spacing:2px; padding:8px; color:white; border-radius:3px; background: #2178BE;
                    background: linear-gradient(90deg, rgba(33, 120, 190, 1) 0%, rgba(40, 71, 95, 1) 100%);">
                    ตัวกรอง
                </h5>

                <div class="mb-2">
                    <label for="date_start" style="color:#555555">วันที่เริ่มต้น:</label>
                    <input type="date" class="form-control" id="date_start" placeholder="วันที่ (dd/mm/yyyy)" />
                </div>

                <div class="mb-2">
                    <label for="date_end" style="color:#555555">วันที่สิ้นสุด:</label>
                    <input type="date" class="form-control" id="date_end" placeholder="วันที่ (dd/mm/yyyy)" />
                </div>

                <label for="mode" style="color:#555555">เลือกดู:</label>
                <select name="modes" id="mode" class="mb-3" style="border-radius:5px">
                    <option value="NULL">Please Select...</option>
                    <option value="CAR">รถ</option>
                    <option value="DRIVER">คนขับรถ</option>
                </select>

                <label for="car" style="color:#555555" id="car-label" class="hidden">รถ:</label>
                <select name="cars" id="car" class="mb-3 hidden" style="border-radius:5px">
                    <option value="NULL">Please Select...</option>
                    <option value="CAR01">CAR#01</option>
                    <option value="CAR02">CAR#02</option>
                    <option value="CAR03">CAR#03</option>
                    <option value="CAR04">CAR#04</option>
                </select>

                <label for="employee" style="color:#555555" id="employee-label" class="hidden">ชื่อพนักงาน:</label>
                <select name="employees" id="employee" class="mb-3 hidden" style="border-radius:5px">
                    <option value="NULL">Please Select...</option>
                    <option value="EM001">Sarit T.</option>
                    <option value="EM002">Kriangkrai R.</option>
                    <option value="EM003">Jirawat J.</option>
                    <option value="EM004">Chakrit R.</option>
                </select>


                <button class="btn btn-primary w-100 mb-2" style="border-radius:8px; box-shadow: 0 4px 8px rgba(0,0,0,0.1);">ค้นหา</button>
            </div>
        </div>

        <!-- Main Content (ขวา) : Table  -->
        <div class="col-md-10 p-3 kanit-regular">
            <h4 class="mb-3" style="letter-spacing:2px; padding:8px; color:white; border-radius:3px; background: #2178BE;
                    background: linear-gradient(90deg, rgba(33, 120, 190, 1) 0%, rgba(40, 71, 95, 1) 100%);">
                รถบริษัท
            </h4>
            <div class="scrollable-table table-responsive-lg">
                <table class="table table-striped table-bordered ">
                    <thead class="bg-primary text-white align-content-center text-center">
                        <tr>
                            <th>วันที่</th>
                            <th>รถ</th>
                            <th>ผู้ขับ</th>
                            <th>ตั้งแต่เวลา</th>
                            <th>ถึงเวลา</th>
                            <th>การเดินทาง</th>
                            <th>ค่าน้ำมัน (Fleet Card)</th>
                            <th>ค่าน้ำมัน (เงินสด)</th>
                            <th>ค่าทางด่วน</th>
                            <th>ค่าใช้จ่ายอื่นๆ</th>
                            <th>เลขไมล์เริ่มต้น</th>
                            <th>เลขไมล์สิ้นสุด</th>
                            <th>ระยะทาง</th>
                            <th>Job</th>
                            <th>สถานะ</th>
                        </tr>
                    </thead>
                    @* <tbody>
                        @foreach (var item in Model)
                        {
                            <tr data-date="@item.date.ToString("dd/MM/yyyy")"
                                data-car_id="@item.car_id"
                                data-driver="@item.driver"
                                data-time_start="@item.time_start.ToString("HH:mm")"
                                data-time_stop="@item.time_stop.ToString("HH:mm")" 
                                data-location="@item.location"
                                data-fleet="@item.fleet"
                                data-cash="@item.cash"
                                data-ctbo="@item.ctbo"
                                data-exp="@item.exp"
                                data-mileage_start="@item.mileage_start"
                                data-mileage_stop="@item.mileage_stop"
                                data-km="@item.km"
                                data-jobno="@item.job"
                                data-status="@item.status"
                                class="clickable-row align-content-center text-center"
                                style="color:#444444">

                                <td>@item.date.ToString("dd/MM/yyyy")</td>
                                <td>@item.car_id</td>
                                <td>@item.driver</td>
                                <td>@item.time_start.ToString("hh:mm:ss")</td>
                                <td>@item.time_stop.ToString("hh:mm:ss")</td> 
                                <td>@item.location</td>
                                <td>@item.fleet</td>
                                <td>@item.cash</td>
                                <td>@item.ctbo</td>
                                <td>@item.exp</td>
                                <td>@item.mileage_start</td>
                                <td>@item.mileage_stop</td>
                                <td>@item.km</td>
                                <td>@item.job</td>
                                <td>@item.status</td>
                            </tr>
                        }
                    </tbody> *@

                    <tbody>
                        @foreach (var item in Model)
                        {
                            <tr class="clickable-row align-content-center text-center"
                                style="color:#444444">

                                <td>16/10/2025</td>
                                <td>CAR#01</td>
                                <td>Sarit T.</td>
                                <td>8:30</td>
                                <td>17:30</td>
                                <td>CTL(HQ)-Ansell-CTL(HQ)  | </td>
                                <td>@item.fleet</td>
                                <td>@item.cash</td>
                                <td>@item.ctbo</td>
                                <td>@item.exp</td>
                                <td>@item.mileage_start</td>
                                <td>@item.mileage_stop</td>
                                <td>@item.km</td>
                                <td>@item.job</td>
                                <td>@item.status</td>
                            </tr>
                        }
                    </tbody>
                </table>

                <!-- Button below Table -->
                <div class="row kanit-medium d-flex justify-content-center g-0">
                    <!-- Button Send & Export -->
                    <div class="col-md-2 bg-light p-2">
                        <button class="btn btn-success w-100" data-toggle="modal" data-target="#sendModal"
                                style="border-radius:8px; box-shadow: 0 4px 8px rgba(0,0,0,0.1);">
                            Send & Export <i class="fas fa-download"></i>
                        </button>
                    </div>
                    <!-- Button Cancel Send -->
                    <div class="col-md-2 bg-light p-2">
                        <button class="btn btn-danger w-100" data-toggle="modal" data-target="#cancelModal"
                                style="border-radius:8px; box-shadow: 0 4px 8px rgba(0,0,0,0.1);">
                            Cancel Send
                        </button>
                    </div>
                </div>

                <!-- Modal: Send & Export -->
                <div class="modal fade " id="sendModal" tabindex="-1" role="dialog" aria-labelledby="sendModalLabel" aria-hidden="true">
                    <div class="modal-dialog" role="document">
                        <div class="modal-content">

                            <!-- Modal Header -->
                            <div class="modal-header"
                                 style="background: #34ba7c;
                                background: linear-gradient(90deg, rgba(52, 186, 124, 1) 0%, rgba(0, 138, 112, 1) 100%); color: white; border-bottom: none;">
                                <h5 class="modal-title" id="cancelModalLabel">Confirm Send & Export</h5>
                                <!-- Close Button -->
                                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                    <span aria-hidden="true" style="color:white">&times;</span>
                                </button>
                            </div>
                            <!-- Modal Body -->
                            <div class="modal-body">
                                <text style="color:#555555">คุณต้องการส่งข้อมูล วันที่ 01/10/2025 - 15/10/2025 ใช่หรือไม่?</text>
                                <label style="color: red; text-align: left; display: block;">
                                    * หลังจากผู้ดูแลอนุมัติแล้ว จะไม่สามารถยกเลิกหรือแก้ไขข้อมูลที่ส่งได้
                                </label>

                            </div>
                            <!-- Footer Button -->
                            <div class="modal-footer">

                                <button type="button" class="btn btn-secondary" style="border-radius:8px; box-shadow: 0 4px 8px rgba(0,0,0,0.1);" data-dismiss="modal">
                                    ปิด
                                </button>
                                <button type="button" id="BtnSendExport" class="btn btn-success" style="border-radius:8px; box-shadow: 0 4px 8px rgba(0,0,0,0.1);">
                                    ยืนยันการส่ง
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Modal: Cancel Send -->
                <div class="modal fade" id="cancelModal" tabindex="-1" role="dialog" aria-labelledby="cancelModalLabel" aria-hidden="true">
                    <div class="modal-dialog " role="document">
                        <div class="modal-content">
                            <!-- Modal Header -->
                            <div class="modal-header"
                                 style="background: #ff2929;
                                 background: linear-gradient(90deg, rgba(255, 41, 41, 1) 0%, rgba(161, 0, 0, 1) 100%); color: white; border-bottom: none;">
                                <h5 class="modal-title" id="cancelModalLabel">Cancel Send</h5>
                                <!-- Close Button -->
                                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                    <span aria-hidden="true" style="color:white">&times;</span>
                                </button>
                            </div>
                            <!-- Modal Body -->
                            <div class="modal-body">
                                <text style="color:red; font-size:18px">คุณแน่ใจหรือไม่ว่าต้องการยกเลิกการส่งข้อมูล <br>วันที่ 01/10/2025 - 15/10/2025 </text>
                            </div>
                            <!-- Footer Button -->
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" style="border-radius:8px; box-shadow: 0 4px 8px rgba(0,0,0,0.1);" data-dismiss="modal">
                                    ปิด
                                </button>
                                <button type="button" id="BtnCancelSend" class="btn btn-danger" style="border-radius:8px; box-shadow: 0 4px 8px rgba(0,0,0,0.1);">
                                    ยืนยันการยกเลิก
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Modal Table -->
<div class="modal fade" id="detailModal" tabindex="-1" role="dialog" aria-labelledby="detailModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-md" role="document">
        <!-- เพิ่ม modal-lg สำหรับขนาดใหญ่ -->
        <div class="modal-content">
            <div class="modal-header" style="background: linear-gradient(90deg, rgba(33, 120, 190, 1) 0%, rgba(40, 71, 95, 1) 100%); color: white; border-bottom: none;">
                <h5 class="modal-title kanit-regular" id="detailModalLabel">แก้ไขข้อมูล (รถบริษัท)</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true" style="color: white;">&times;</span>
                </button>
            </div>
            <div class="modal-body kanit-regular" style="color:#444444">
                <form>
                    <!-- ROW 1 : วันที่, Job -->
                    <div class="form-row ">
                        <fieldset disabled class="col-sm-12 col-md-6">
                            <div class="form-group">
                                <label for="disabledTextInputDate">วันที่</label>
                                <input type="text" class="form-control" id="disabledTextInputDate" placeholder="08/10/2025">
                            </div>
                        </fieldset>
                        <div class="form-group col-sm-12 col-md-6">
                            <label for="inputJob">Job</label>
                            <input type="text" class="form-control" id="inputJob" placeholder="Jxx-xxxx">
                        </div>

                    </div>

                    <!-- ROW 2 : ลูกค้า, จังหวัด -->
                    <div class="form-row">
                        <div class="form-group col-sm-12 col-md-8">
                            <label for="inputCustomer">ลูกค้า</label>
                            <input type="text" class="form-control" id="inputCustomer" placeholder="Ex. HOTEL, CTL-(HQ)">
                        </div>
                        <div class="form-group col-sm-12 col-md-4">
                            <label for="inputProvince">จังหวัด</label>
                            <input type="text" class="form-control" id="inputProvince" placeholder="Ex. กรุงเทพ">
                        </div>
                    </div>

                    <!-- ROW 3 : เบี้ยเลี้ยง -->
                    <label>เบี้ยเลี้ยง</label>
                    <div class="form-group ">
                        <div class="form-check form-check-inline col-sm-6 col-md-3 mb-1">
                            <input class="form-check-input" type="checkbox" id="inlineCheckboxAllowance_1_4" value="option1">
                            <label class="form-check-label" for="inlineCheckboxAllowance_1_4">1-4 ชม.</label>
                        </div>
                        <div class="form-check form-check-inline col-sm-6 col-md-3 mb-1">
                            <input class="form-check-input" type="checkbox" id="inlineCheckboxAllowance_4_8" value="option2">
                            <label class="form-check-label" for="inlineCheckboxAllowance_4_8">4-8 ชม.</label>
                        </div>
                        <div class="form-check form-check-inline col-sm-6 col-md-3 mb-1">
                            <input class="form-check-input" type="checkbox" id="inlineCheckboxAllowance_8_up" value="option3">
                            <label class="form-check-label" for="inlineCheckboxAllowance_8_up">8 ชม. ขึ้นไป</label>
                        </div>
                        <div class="form-check form-check-inline col-sm-6 col-md-3 mb-1">
                            <input class="form-check-input" type="checkbox" id="inlineCheckboxAllowance_province" value="option4">
                            <label class="form-check-label" for="inlineCheckboxAllowance_province">ต่างจังหวัด</label>
                        </div>
                        @* <div class="form-check form-check-inline col-sm-6 col-md-3 mb-1">
                        <input class="form-check-input" type="checkbox" id="inlineCheckboxAllowance_abroad" value="option5">
                        <label class="form-check-label" for="inlineCheckboxAllowance_abroad">ต่างประเทศ</label>
                        </div> *@

                        @* <div class="form-check form-check-inline col-sm-6 col-md-6 mb-1">
                        <input class="form-check-input" type="checkbox" id="inlineCheckboxAllowance_other" value="option6">
                        <label class="form-check-label" for="inlineCheckboxAllowance_other" style="margin-right:10px">อื่นๆ </label>
                        <div class="input-group">
                        <input type="text" class="form-control col-sm-8 col-md-8" style="text-align:end" id="inputAllowance_other" placeholder="0">
                        <div class="input-group-append">
                        <span class="input-group-text">฿</span>
                        </div>
                        </div>
                        </div> *@

                        <div class="form-check form-check-inline col-sm-6 col-md-6 mb-1">
                            <input class="form-check-input" type="checkbox" id="inlineCheckboxAllowance_other" value="option6">
                            <label class="form-check-label" for="inlineCheckboxAllowance_other" style="margin-right:10px">อื่นๆ </label>
                            <div class="input-group">
                                <input type="text" class="form-control col-sm-8 col-md-8" style="text-align:end" id="inputAllowance_other" placeholder="0" disabled>
                                <div class="input-group-append">
                                    <span class="input-group-text">฿</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- ROW 4 : ค่าที่พัก, ค่าใช้จ่ายอื่นๆ, รายการ -->
                    <div class="form-row ">
                        <div class="form-group col-sm-12 col-md-4">
                            <label for="inputAllowance_hostel">ค่าที่พัก</label>
                            <div class="input-group">
                                <input type="text" class="form-control" style="text-align:end" id="inputAllowance_hostel" placeholder="0">
                                <div class="input-group-append">
                                    <span class="input-group-text">฿</span>
                                </div>
                            </div>
                        </div>
                        <div class="form-group col-sm-12 col-md-4">
                            <label for="inputList">ค่าใช้จ่ายอื่นๆ</label>
                            <input type="text" class="form-control" id="inputList" placeholder="Ex. เลี้ยงลูกค้า">
                        </div>
                        <div class="form-group col-sm-12 col-md-4">
                            <label for="inputList_amount">จำนวนเงิน</label>
                            <div class="input-group">
                                <input type="text" class="form-control" style="text-align:end" id="inputList_amount" placeholder="0">
                                <div class="input-group-append">
                                    <span class="input-group-text">฿</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    @*
                    <td>@item.remark</td>
                    <td>@item.status</td> *@

                    <!-- ROW 5 : หมายเหตุ, รวม -->
                    <div class="form-row">
                        <div class="form-group col-sm-12 col-md-8">
                            <label for="inputRemark">หมายเหตุ</label>
                            <input type="text" class="form-control" id="inputRemark">
                        </div>
                        <fieldset disabled class="col-sm-12 col-md-4">
                            <div class="form-group">
                                <label for="disabledTextInputAllowance_sum">รวม</label>
                                <div class="input-group">
                                    <input type="text" class="form-control" style="text-align:end" id="disabledTextInputAllowance_sum" placeholder="0">
                                    <div class="input-group-append">
                                        <span class="input-group-text">฿</span>
                                    </div>
                                </div>
                            </div>

                        </fieldset>
                    </div>

                    <!-- ROW 6 : อัปเดตล่าสุด, ผู้ดำเนินการ -->
                    <div class="form-row ">
                        <fieldset disabled class="col-sm-12 col-md-6">
                            <div class="form-group">
                                <label for="disabledTextInputLastUpdated">อัปเดตล่าสุด</label>
                                <input type="text" class="form-control" id="disabledTextInputLastUpdated" placeholder="08/10/2025 12:34:56">
                            </div>
                        </fieldset>
                        <fieldset disabled class="col-sm-12 col-md-6">
                            <div class="form-group">
                                <label for="disabledTextInputAdmin">ผู้ดำเนินการ</label>
                                <input type="text" class="form-control" id="disabledTextInputAdmin" placeholder="Kriangkrai R.">
                            </div>
                        </fieldset>
                    </div>
                </form>
            </div>
            <!-- Footer Button -->
            <div class="modal-footer kanit-regular">
                <button type="button" class="btn btn-outline-danger col-sm-3 col-md-2" style="border-radius:8px; box-shadow: 0 4px 8px rgba(0,0,0,0.1);" data-dismiss="modal">
                    ยกเลิก
                </button>
                <button type="button" id="BtnSaveChange" class="btn btn-primary col-sm-3 col-md-3" style="border-radius:8px; box-shadow: 0 4px 8px rgba(0,0,0,0.1);">
                    บันทึก
                </button>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        $(document).ready(function () {
            $(".clickable-row").click(function () {
                var date = $(this).data("date");
                var time = $(this).data("time");
                var customer = $(this).data("customer");
                var zipcode = $(this).data("zipcode");
                var jobNo = $(this).data("jobno");
                var allowanceProvince = $(this).data("allowance-province");
                var allowance1_4 = $(this).data("allowance-1-4");
                var allowance4_8 = $(this).data("allowance-4-8");
                var allowance8 = $(this).data("allowance-8");
                var allowanceOther = $(this).data("allowance-other");
                var allowanceHostel = $(this).data("allowance-hostel");
                var list = $(this).data("list");
                var description = $(this).data("description");
                var remark = $(this).data("remark");
                var status = $(this).data("status");

                $("#modalDate").text(date || "-");
                $("#modalTime").text(time || "-");
                $("#modalCustomer").text(customer || "-");
                $("#modalZipcode").text(zipcode || "-");
                $("#modalJobNo").text(jobNo || "-");
                $("#modalAllowanceProvince").text(allowanceProvince || "-");
                $("#modalAllowance1_4").text(allowance1_4 || "-");
                $("#modalAllowance4_8").text(allowance4_8 || "-");
                $("#modalAllowance8").text(allowance8 || "-");
                $("#modalAllowanceOther").text(allowanceOther || "-");
                $("#modalAllowanceHostel").text(allowanceHostel || "-");
                $("#modalList").text(list || "-");
                $("#modalDescription").text(description || "-");
                $("#modalRemark").text(remark || "-");
                $("#modalStatus").text(status || "-");

                $("#detailModal").modal("show");
            });

            // ปิด Modal
            $(".close, [data-dismiss='modal']").click(function () {
                $("#detailModal").modal("hide");
            });

            // ฟังก์ชันปุ่มใน Modal (ตัวอย่าง)
            $("#editButton").click(function () {
                alert("บันทึกข้อมูลสำเร็จ: " + $("#modalDate").text() + " เวลา " + $("#modalTime").text());
                // เพิ่มโค้ดสำหรับการแก้ไข (เช่น Redirect หรือ Form)
            });

            $("#deleteButton").click(function () {
                if (confirm("คุณแน่ใจหรือไม่ที่จะลบข้อมูลนี้?")) {
                    alert("ลบข้อมูล: " + $("#modalDate").text());
                    // เพิ่มโค้ดสำหรับการลบ (เช่น AJAX Call)
                    $("#detailModal").modal("hide");
                }
            });

            // หา Checkbox และ Input
            const checkbox = document.getElementById('inlineCheckboxAllowance_other');
            const input = document.getElementById('inputAllowance_other');

            // เพิ่ม event listener สำหรับ Checkbox
            checkbox.addEventListener('change', function () {
                input.disabled = !this.checked; // ถ้าไม่ติ๊ก = disabled, ถ้าติ๊ก = enable
            });

            checkbox.addEventListener('change', function () {
                input.disabled = !this.checked;
                if (!this.checked) {
                    input.value = ''; // ล้างช่องเมื่อยกเลิกติ๊ก
                }
            });
        });
    </script>
    <script>
        document.getElementById('mode').addEventListener('change', function () {
            const mode = this.value;
            const carSelect = document.getElementById('car');
            const carLabel = document.getElementById('car-label');
            const employeeSelect = document.getElementById('employee');
            const employeeLabel = document.getElementById('employee-label');

            // ซ่อนทั้งสอง select และ label ก่อน
            carSelect.classList.add('hidden');
            carLabel.classList.add('hidden');
            employeeSelect.classList.add('hidden');
            employeeLabel.classList.add('hidden');

            // แสดง select และ label ตามโหมดที่เลือก
            if (mode === 'CAR') {
                carSelect.classList.remove('hidden');
                carLabel.classList.remove('hidden');
            } else if (mode === 'DRIVER') {
                employeeSelect.classList.remove('hidden');
                employeeLabel.classList.remove('hidden');
            }
        });
    </script>


}